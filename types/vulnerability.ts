/**
 * Type definitions untuk data vulnerability management
 */

/**
 * OWASP Risk Vector metrics
 */
export interface OWASPRiskVector {
  SL: number; // Security Level
  M: number;  // Modified
  O: number;  // Origin
  S: number;  // Scope
  ED: number; // Exploitability Difficulty
  EE: number; // Exploitability Ease
  A: number;  // Attack Vector
  ID: number; // Impact Damage
  LC: number; // Likelihood of Compromise
  LI: number; // Likelihood of Integrity
  LAV: number; // Likelihood of Availability
  LAC: number; // Likelihood of Confidentiality
  FD: number; // Financial Damage
  RD: number; // Reputation Damage
  NC: number; // Non-Compliance
  PV: number; // Privacy Violation
}

/**
 * Risk level classification
 */
export type RiskLevel = "Critical" | "High" | "Medium" | "Low";

/**
 * Status mitigasi
 */
export type MitigationStatus = "Open" | "Closed" | "In Progress";

/**
 * Data vulnerability dari CSV
 */
export interface Vulnerability {
  id: string; // No. (e.g., TE-01)
  namaKerentanan: string;
  mstgWstg: string;
  jalurLokasiTerdampak: string;
  owaspRiskRating: string; // Vector string
  owaspVector?: OWASPRiskVector; // Parsed vector
  objekTerdampak: string;
  ki: string; // Kemungkinan Dampak dan Risiko Inheren - Confidentiality
  di: string; // Kemungkinan Dampak dan Risiko Inheren - Integrity
  ri: string; // Kemungkinan Dampak dan Risiko Inheren - Availability
  deskripsi: string;
  rekomendasiMitigasi: string;
  pj: string; // Person in charge
  tenggat: string; // Deadline
  statusMitigasi: string;
  keteranganRemediasi: string;
  newEndpoint: string;
  kr: string; // Kemungkinan Dampak dan Risiko Residual - Confidentiality
  dr: string; // Kemungkinan Dampak dan Risiko Residual - Integrity
  rr: string; // Kemungkinan Dampak dan Risiko Residual - Availability
  keteranganRetest: string;
  retest1: string; // Retest #1 status
  klasifikasiTemuan: string;
  retest2: string;
  
  // Calculated fields
  calculatedRiskLevel?: RiskLevel;
  initialRiskLevel?: RiskLevel; // Risk level Inheren (berdasarkan KI, DI, RI)
  retestRiskLevel?: RiskLevel; // Risk level Residual (berdasarkan KR, DR, RR)
  riskReductionPercentage?: number; // Persentase penurunan risiko (Inheren -> Residual)
}

/**
 * Workbook data (collection of vulnerabilities from one CSV file)
 */
export interface WorkbookData {
  id: string;
  name: string; // Extracted from filename
  uploadedAt: Date;
  expiresAt: Date;
  vulnerabilities: Vulnerability[];
  
  // Statistics
  totalVulnerabilities: number;
  riskDistribution: Record<RiskLevel, number>;
  riskDistributionInheren: Record<RiskLevel, number>; // Distribusi risiko inheren
  riskDistributionResidual: Record<RiskLevel, number>; // Distribusi risiko residual
  statusDistribution: Record<MitigationStatus, number>;
  progressPercentage: number;
  averageRiskReduction?: number; // Rata-rata penurunan risiko
}

/**
 * Store state untuk vulnerability management
 */
export interface VulnStore {
  workbooks: Map<string, WorkbookData>;
  uploadedAt: Map<string, Date>;
  autoCleanupInterval: number; // in milliseconds (default: 2 hours)
  cleanupTimer?: NodeJS.Timeout;
  
  // Actions
  addWorkbook: (workbook: WorkbookData) => void;
  removeWorkbook: (id: string) => void;
  getWorkbook: (id: string) => WorkbookData | undefined;
  getAllWorkbooks: () => WorkbookData[];
  clearAllWorkbooks: () => void;
  startAutoCleanup: () => void;
  stopAutoCleanup: () => void;
  checkExpiredWorkbooks: () => string[]; // Returns expired workbook IDs
}

